{
  "openapi": "3.0.3",
  "info": {
    "title": "RWA API",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "http://localhost:3000/v1"
    }
  ],
  "paths": {
    "/auth/signup": {
      "post": {
        "summary": "Create a new user account",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SignupRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Login with email/password",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Session tokens",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/2fa/verify": {
      "post": {
        "summary": "Verify 2FA code",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TwoFaVerifyRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "2FA verified"
          }
        }
      }
    },
    "/kyc/submit": {
      "post": {
        "summary": "Submit KYC data",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/KycSubmission"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "KYC submitted"
          }
        }
      }
    },
    "/kyc/status": {
      "get": {
        "summary": "Get KYC status",
        "responses": {
          "200": {
            "description": "Current KYC status",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/KycStatus"
                }
              }
            }
          }
        }
      }
    },
    "/assets": {
      "get": {
        "summary": "List public assets",
        "parameters": [
          {
            "in": "query",
            "name": "type",
            "schema": {
              "type": "string",
              "enum": [
                "land",
                "truck",
                "hotel",
                "house",
                "other"
              ]
            }
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "in": "query",
            "name": "offset",
            "schema": {
              "type": "integer",
              "minimum": 0
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Asset list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaginatedAssets"
                }
              }
            }
          }
        }
      }
    },
    "/assets/{id}": {
      "get": {
        "summary": "Get asset details",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Asset",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Asset"
                }
              }
            }
          }
        }
      }
    },
    "/admin/assets": {
      "post": {
        "summary": "Create asset (admin)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AssetCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/admin/assets/{id}/verify": {
      "post": {
        "summary": "Verify asset (admin)",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Verified"
          }
        }
      }
    },
    "/orderbook/{assetId}": {
      "get": {
        "summary": "Get orderbook for asset",
        "parameters": [
          {
            "in": "path",
            "name": "assetId",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "side",
            "schema": {
              "type": "string",
              "enum": [
                "buy",
                "sell"
              ]
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order list",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaginatedOrders"
                }
              }
            }
          }
        }
      }
    },
    "/orders": {
      "post": {
        "summary": "Post an order",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OrderRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Order"
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "List my orders",
        "parameters": [
          {
            "in": "query",
            "name": "user_id",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "side",
            "schema": {
              "type": "string",
              "enum": [
                "buy",
                "sell"
              ]
            }
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string",
              "enum": [
                "open",
                "partially_filled",
                "filled",
                "cancelled"
              ]
            }
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer"
            }
          },
          {
            "in": "query",
            "name": "offset",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Orders",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PaginatedOrders"
                }
              }
            }
          }
        }
      }
    },
    "/orders/{id}": {
      "delete": {
        "summary": "Cancel order",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Cancelled"
          }
        }
      }
    },
    "/agents/apply": {
      "post": {
        "summary": "Apply to become an agent",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AgentApplication"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Submitted"
          }
        }
      }
    },
    "/agents/search": {
      "get": {
        "summary": "Search agents by region/skill/rating",
        "parameters": [
          {
            "in": "query",
            "name": "region",
            "schema": {
              "type": "string"
            }
          },
          {
            "in": "query",
            "name": "rating_gte",
            "schema": {
              "type": "number"
            }
          },
          {
            "in": "query",
            "name": "skill",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Agent list"
          }
        }
      }
    },
    "/admin/agents/{id}": {
      "patch": {
        "summary": "Approve/suspend agent (admin)",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AgentStatusUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          }
        }
      }
    },
    "/verification/jobs": {
      "post": {
        "summary": "Create a verification job (escrow fee)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JobCreate"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/verification/jobs/{id}": {
      "get": {
        "summary": "Get job",
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Job"
          }
        }
      },
      "patch": {
        "summary": "Assign or update job",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/JobUpdate"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Updated"
          }
        }
      }
    },
    "/verification/jobs/{id}/report": {
      "post": {
        "summary": "Submit verification report",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ReportSubmit"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Submitted"
          }
        }
      }
    },
    "/verification/jobs/{id}/accept": {
      "post": {
        "summary": "Investor accepts report (release escrow)",
        "responses": {
          "200": {
            "description": "Accepted"
          }
        }
      }
    },
    "/verification/jobs/{id}/reject": {
      "post": {
        "summary": "Investor rejects report",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "reason": {
                    "type": "string"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rejected"
          }
        }
      }
    },
    "/agents/{id}/reviews": {
      "post": {
        "summary": "Rate and review an agent",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AgentReview"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Created"
          }
        }
      }
    },
    "/distributions/{assetId}": {
      "get": {
        "summary": "List distributions for asset",
        "parameters": [
          {
            "in": "path",
            "name": "assetId",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Distributions"
          }
        }
      }
    },
    "/admin/distributions/trigger": {
      "post": {
        "summary": "Trigger a payout batch (admin)",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TriggerRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Batch queued"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SignupRequest": {
        "type": "object",
        "required": [
          "email",
          "password"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "password": {
            "type": "string",
            "format": "password"
          },
          "phone": {
            "type": "string"
          }
        }
      },
      "LoginRequest": {
        "type": "object",
        "required": [
          "email",
          "password"
        ],
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "password": {
            "type": "string",
            "format": "password"
          }
        }
      },
      "TwoFaVerifyRequest": {
        "type": "object",
        "required": [
          "code"
        ],
        "properties": {
          "code": {
            "type": "string"
          }
        }
      },
      "KycSubmission": {
        "type": "object",
        "properties": {
          "documentType": {
            "type": "string"
          },
          "documentNumber": {
            "type": "string"
          },
          "country": {
            "type": "string"
          }
        }
      },
      "KycStatus": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "submitted",
              "approved",
              "rejected"
            ]
          }
        }
      },
      "AuthResponse": {
        "type": "object",
        "required": [
          "access_token"
        ],
        "properties": {
          "access_token": {
            "type": "string"
          }
        }
      },
      "PaginatedAssets": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Asset"
            }
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "hasMore": {
            "type": "boolean"
          }
        }
      },
      "Asset": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "type": {
            "type": "string",
            "enum": [
              "land",
              "truck",
              "hotel",
              "house",
              "other"
            ]
          },
          "title": {
            "type": "string"
          },
          "spv_id": {
            "type": "string"
          },
          "status": {
            "type": "string"
          },
          "nav": {
            "type": "string"
          },
          "verification_required": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "AssetCreate": {
        "type": "object",
        "required": [
          "type",
          "title"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "land",
              "truck",
              "hotel",
              "house",
              "other"
            ]
          },
          "title": {
            "type": "string"
          },
          "spv_id": {
            "type": "string"
          },
          "status": {
            "type": "string"
          },
          "nav": {
            "type": "number"
          },
          "verification_required": {
            "type": "boolean"
          }
        }
      },
      "PaginatedOrders": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Order"
            }
          },
          "total": {
            "type": "integer"
          },
          "limit": {
            "type": "integer"
          },
          "offset": {
            "type": "integer"
          },
          "hasMore": {
            "type": "boolean"
          }
        }
      },
      "OrderRequest": {
        "type": "object",
        "required": [
          "asset_id",
          "side",
          "qty",
          "price"
        ],
        "properties": {
          "asset_id": {
            "type": "integer"
          },
          "side": {
            "type": "string",
            "enum": [
              "buy",
              "sell"
            ]
          },
          "qty": {
            "type": "number"
          },
          "price": {
            "type": "number"
          }
        }
      },
      "Order": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "user_id": {
            "type": "integer"
          },
          "asset_id": {
            "type": "integer"
          },
          "side": {
            "type": "string",
            "enum": [
              "buy",
              "sell"
            ]
          },
          "qty": {
            "type": "string"
          },
          "price": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "open",
              "partially_filled",
              "filled",
              "cancelled"
            ]
          },
          "filled_qty": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "AgentApplication": {
        "type": "object",
        "properties": {
          "regions": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "skills": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "bio": {
            "type": "string"
          }
        }
      },
      "AgentStatusUpdate": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "pending",
              "approved",
              "suspended"
            ]
          }
        }
      },
      "JobCreate": {
        "type": "object",
        "required": [
          "asset_id",
          "price",
          "currency"
        ],
        "properties": {
          "asset_id": {
            "type": "string"
          },
          "price": {
            "type": "number"
          },
          "currency": {
            "type": "string"
          },
          "agent_id": {
            "type": "string"
          }
        }
      },
      "JobUpdate": {
        "type": "object",
        "properties": {
          "agent_id": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": [
              "assigned",
              "submitted",
              "accepted",
              "rejected",
              "disputed"
            ]
          }
        }
      },
      "ReportSubmit": {
        "type": "object",
        "properties": {
          "summary": {
            "type": "string"
          },
          "checklist": {
            "type": "object"
          },
          "photos": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "videos": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "gps_path": {
            "type": "array",
            "items": {
              "type": "number"
            },
            "description": "encoded polyline or list [lat,lon,...]"
          },
          "doc_hashes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "AgentReview": {
        "type": "object",
        "required": [
          "score"
        ],
        "properties": {
          "score": {
            "type": "integer",
            "minimum": 1,
            "maximum": 5
          },
          "comment": {
            "type": "string"
          }
        }
      },
      "TriggerRequest": {
        "type": "object",
        "required": [
          "asset_id",
          "period",
          "gross"
        ],
        "properties": {
          "asset_id": {
            "type": "string"
          },
          "period": {
            "type": "string",
            "description": "ISO8601 period, e.g., 2024-01/2024-03"
          },
          "gross": {
            "type": "number"
          },
          "mgmt_fee_bps": {
            "type": "integer"
          },
          "carry_bps": {
            "type": "integer"
          }
        }
      }
    }
  }
}